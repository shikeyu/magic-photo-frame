# Magic Photo Frame User Guide

[Chinese Version](README.md)

**Magic Photo Frame** is a Web-based frontend application designed to connect to a local ComfyUI service, transforming static photos into vivid dynamic videos and displaying them immersively in an "Electronic Photo Frame" format.

> **Note: All code in this project was automatically generated by the AI coding assistant [Trae](https://www.trae.ai).**

---

## üöÄ Quick Start

### 1. Preparation
*   **Start ComfyUI**: Ensure your ComfyUI is running locally.
    *   **Important**: You must allow Cross-Origin Resource Sharing (CORS) when starting. Use the following arguments:
        ```bash
        python main.py --listen --port 8188 --enable-cors-header
        ```
*   **Model and Node Requirements** (for the built-in default workflow):
    *   **Required Models**:
        1.  Checkpoint: `wan2.2-i2v-rapid-aio-v10-nsfw.safetensors`
        2.  CLIP Vision: `clip_vision_h.safetensors`
    *   **Required Custom Nodes**:
        *   ComfyUI-VideoHelperSuite (VHS)
        *   ComfyUI-LayerStyle (LayerUtility)
        *   WanVideo related nodes (WanImageToVideo)
        *   **ComfyUI-Browser** (For history synchronization and file management)
*   **Open Application**: Open `index.html` in your browser (Recommended to run via a local server, e.g., `python -m http.server`).

### 2. Connect Service
1.  Enter your address in the **"ComfyUI Server URL"** input box at the top of the page (Default `http://127.0.0.1:8188`).
2.  Click **"Check Connection"**. If the status shows a green "Connected", the connection is successful.

### 3. Configure Workflow
1.  **Import/Export Function**:
    *   **Import**: Click **"Import Workflow"** (Ctrl+I) to support `.json` or `.yaml` files (Max size ‚â§10MB). The system automatically identifies and parses the content.
    *   **Export**: Click **"Export Workflow"** (Ctrl+E) to save the current editor content as a standard JSON file, with a timestamped filename.
    *   **Manual Paste**: You can also paste ComfyUI API format workflow (JSON) directly into the text box.
2.  **Placeholder Support**: The app automatically replaces the following content without manual JSON modification:
    *   `{{IMAGE_FILENAME}}`: Uploaded image filename.
    *   `{{PROMPT}}`: Prompt text.
    *   `{{VIDEO_SCALE}}`: Video resolution (long side).
    *   `seed`: Random seed (automatically randomized).
3.  Click **"Set as Default"** to save the current workflow, which will automatically load on the next page refresh.

### 4. Add Images
1.  Click the **"Add Files"** button to select local images (supports multi-selection).
2.  Images are automatically checked for cropping (Recommended 3:4 ratio). You can adjust them in the popup cropper.
3.  **Custom Prompts**: Click the **"‚úé"** button on the image thumbnail to set individual prompts for each image (e.g., "make the fire move"). If not set, the global default prompts will be used.
4.  **Save/Load List**: You can save the current image list (including prompt configurations) to a local JSON file for easy loading next time.

### 5. Generation and Result Management
*   **Manual Generation**: Click the **"Generate Magic Video"** button, and the app will process images in the list sequentially.
*   **Result Preview**:
    *   **Card Grid**: Click any image to show all generated video results in a 3:4 vertical grid on the right (or bottom).
    *   **Video Info**: Resolution and duration are displayed at the bottom of each card.
    *   **Delete Function**: Click the **"‚úï"** button at the top right of the card to delete the video.
        *   **Smart Anti-Resurrection**: Deleted videos are added to a local blocklist, preventing them from reappearing even after clicking "Sync History".
*   **Sync History (üîÑ)**:
    *   Click the **"Sync History"** button to fetch history records from the ComfyUI backend.
    *   **Auto Deduplication**: The current list is cleared before syncing to prevent data duplication.

---

## üñºÔ∏è Photo Frame Mode

This is the core feature of the app, turning your screen into a dynamic electronic photo frame.

### Enter Mode
Click the **"Start Photo Frame"** button to enter full-screen display.

### Core Features
1.  **Mixed Display**: The frame rotates through static photos. If a photo has a generated video, it will play the video clip with a seamless transition.
2.  **Background Auto-Generation**:
    *   While you enjoy the photos, the background silently generates new videos for images without videos (or those below the max limit).
    *   New videos **jump the queue immediately** for playback, letting you see the magic effect as soon as possible.
3.  **Multi-Version Rotation**:
    *   The system supports a "One-to-Many" mode. One image can correspond to multiple different video variants.
    *   Each time the image is shown, one version is randomly played to keep things fresh.

### Settings Options
In the **"Photo Frame Settings"** panel at the bottom of the page, you can adjust:
*   **Photo Duration**: Time a static image stays on screen.
*   **Video Probability**: Probability of playing a corresponding video when an image is shown (Recommended low value for surprises, or 100% for full dynamic).
*   **Max Videos Per Image**: Limit the number of video variants per image (Default 5) to prevent unlimited storage usage.
*   **Auto Background Gen**: Toggle background generation. If off, only existing videos are played.
*   **Background Music**: Enter an audio URL to auto-loop music in photo frame mode.
*   **Default Prompts**: Configure a global library of default prompts (one per line). When an image has no specific prompt, one is randomly selected from here.
    *   **Recommended Examples**:
        ```text
        make the image move, vivid scene
        video of a vivid scene, high quality
        cinematic lighting, 4k, slow motion
        ```
*   **Show Clock**: Display current date and time in the bottom right corner.

### Control Operations
*   **Exit**: Click the **"√ó"** button in the top right, or press the **`Esc`** key.
*   **Quick Add**: Click the **"+"** button in the top left to add a new image anytime, crop it, enter prompts, and immediately add it to the playback queue.
*   **Smart Interaction**: Control buttons automatically hide after 3 seconds of inactivity. Move the mouse or tap the screen to wake them up; when hidden, you can also wake them via the bottom-right blind zone.
*   **Manual Switch**: Click anywhere on the screen, or press **`Space` / `‚Üí`** to immediately switch to the next image.
*   **Reset State**: Click the **"Reset Video State"** button in the settings area to clear all associated video records and force regeneration.

---

## üõ†Ô∏è FAQ

**Q: Why nothing happens when I click "Generate"?**
A: Please check: 1. Is ComfyUI connected? 2. Is the workflow JSON valid? 3. Have you added at least one image?

**Q: Why is it always static photos in Photo Frame Mode, no videos?**
A: Video generation takes time. Please wait patiently, or check the console logs to confirm background generation is running. Once the first video is ready, it will play automatically.

**Q: I can't see previous videos after clicking an image?**
A: Please click the **"üîÑ Sync History"** button, and the system will retrieve all generated video records from the backend.

**Q: What happens if I delete videos in the output directory?**
A: Playback will fail, and the program will automatically skip and clear that record. It is recommended to use the delete button within the app for management.
